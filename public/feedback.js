import{r as t,j as o,d as E,a as k}from"./assets/client-BvVabS4i.js";const j=n=>{if(!(n instanceof Element))return"";const d=[];for(;n.nodeType===Node.ELEMENT_NODE;){let i=n.nodeName.toLowerCase();if(n.id){i+="#"+n.id,d.unshift(i);break}else{let c=n,s=1;for(;c=c.previousElementSibling;)c.nodeName.toLowerCase()===i&&s++;s!==1&&(i+=`:nth-of-type(${s})`)}d.unshift(i),n=n.parentNode}return d.join(" > ")},C=()=>{const[n,d]=t.useState(null),[i,c]=t.useState(null),[s,p]=t.useState(!1),[a,x]=t.useState(null),[f,b]=t.useState(""),[m,w]=t.useState([]);t.useEffect(()=>{const e=document.querySelector('script[src*="feedback.js"]');e&&(d(e.getAttribute("data-project-id")),c(e.getAttribute("data-feedback-id")))},[]),t.useEffect(()=>{const e=r=>{r.key==="c"&&r.altKey&&p(l=>!l)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);const u=t.useCallback(e=>{if(s){e.preventDefault(),e.stopPropagation();const r=e.target;x(j(r)),p(!1)}},[s]);t.useEffect(()=>(s?(document.body.style.cursor="crosshair",document.addEventListener("click",u,!0)):(document.body.style.cursor="default",document.removeEventListener("click",u,!0)),()=>{document.body.style.cursor="default",document.removeEventListener("click",u,!0)}),[s,u]),t.useEffect(()=>{const e=()=>{w(r=>r.map(l=>{const v=document.querySelector(l.selector);if(v){const y=v.getBoundingClientRect();return{...l,position:{top:y.top+window.scrollY,left:y.left+window.scrollX}}}return{...l,position:null}}))};return window.addEventListener("scroll",e),window.addEventListener("resize",e),e(),()=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",e)}},[m.length]);const g=e=>{e.preventDefault(),f.trim()&&a&&(w([...m,{id:Date.now(),selector:a,text:f,position:null}]),b(""),x(null))};return!n||!i?null:o.jsxs(o.Fragment,{children:[m.map(e=>e.position&&o.jsx("div",{style:{position:"absolute",top:`${e.position.top}px`,left:`${e.position.left}px`,zIndex:1e3,width:"32px",height:"32px",background:"blue",borderRadius:"50%",color:"white",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},title:e.text,children:e.id},e.id)),o.jsxs("div",{style:{position:"fixed",top:10,right:10,zIndex:1001,background:"white",padding:"10px",border:"1px solid #ccc",borderRadius:"8px"},children:[o.jsx("button",{onClick:()=>p(e=>!e),style:{width:"100%",marginBottom:"10px"},children:s?"Cancel":"Add Comment (Alt+C)"}),a&&o.jsxs("form",{onSubmit:g,children:[o.jsxs("p",{style:{fontSize:"12px",wordBreak:"break-all"},children:["Selected: ",a]}),o.jsx("textarea",{value:f,onChange:e=>b(e.target.value),placeholder:"Leave a comment...",rows:3,style:{width:"100%",margin:"5px 0"},autoFocus:!0}),o.jsx("button",{type:"submit",children:"Submit"})]})]})]})},h=document.createElement("div");h.id="client-dashboard-feedback-tool";document.body.appendChild(h);const S=E.createRoot(h);S.render(o.jsx(k.StrictMode,{children:o.jsx(C,{})}));
